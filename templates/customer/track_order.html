{% extends 'layout/base.html' %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/pages/_track_order.css') }}"
/>
{% endblock %} {% block content %}
<div class="container">
  <div class="auth-container">
    <h2 class="auth-container__title">Track Your Order</h2>

    <form
      method="POST"
      action="{{ url_for('customer.track_order') }}"
      class="track-form"
    >
      <div class="form-group">
        <label class="form-label">Order ID:</label>
        <input
          type="text"
          name="order_code"
          required
          class="form-input"
          placeholder="e.g., 1001"
        />
      </div>

      <div class="form-group">
        <label class="form-label">Email Address:</label>
        <input
          type="email"
          name="email"
          required
          class="form-input"
          placeholder="Enter the email used for booking"
        />
      </div>

      <button type="submit" class="btn">Track Order</button>
    </form>
  </div>

  {% if order %}
  <div class="card order-details-card">
    <h3 class="card__title">Order Details #{{ order.order_code }}</h3>

    <!-- Status Indicator -->
    <div class="status-indicator">
      <div class="status-steps">
        <div
          class="status-step {% if order.order_status == 'Confirmed' or order.order_status == 'Active' or order.order_status == 'Completed' %}status-step--completed{% elif order.order_status == 'Confirmed' %}status-step--active{% endif %}"
        >
          <div class="status-step__icon">✓</div>
          <div class="status-step__label">Confirmed</div>
        </div>
        <div
          class="status-step {% if order.order_status == 'Active' or order.order_status == 'Completed' %}status-step--completed{% elif order.order_status == 'Active' %}status-step--active{% endif %}"
        >
          <div class="status-step__icon">✈</div>
          <div class="status-step__label">Active</div>
        </div>
        <div
          class="status-step {% if order.order_status == 'Completed' %}status-step--completed{% endif %}"
        >
          <div class="status-step__icon">✓</div>
          <div class="status-step__label">Completed</div>
        </div>
      </div>
    </div>

    <div class="order-info">
      <div class="detail-row">
        <span class="detail-label">Status:</span>
        <span
          class="detail-value badge {% if order.order_status == 'Confirmed' %}badge-success{% elif order.order_status == 'Active' %}badge-success{% else %}badge-secondary{% endif %}"
        >
          {{ order.order_status }}
        </span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Date:</span>
        <span class="detail-value">{{ order.order_date }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Flight:</span>
        <span class="detail-value"
          >{{ order.source_airport }} -> {{ order.dest_airport }}</span
        >
      </div>
      <div class="detail-row">
        <span class="detail-label">Departure:</span>
        <span class="detail-value">{{ order.departure_time }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Total Payment:</span>
        <span class="detail-value">
          {% if order.order_status == 'Customer Cancelled' %}
            <div style="line-height: 1.6;">
              <div><strong>Original Price:</strong> ${{ "%.2f"|format(order.original_payment) }}</div>
              <div style="color: #dc3545;"><strong>Cancellation Fee (5%):</strong> ${{ "%.2f"|format(order.total_payment) }}</div>
              <div style="color: #28a745;"><strong>Refund Amount:</strong> ${{ "%.2f"|format(order.original_payment|float - order.total_payment|float) }}</div>
            </div>
          {% else %}
            ${{ "%.2f"|format(order.total_payment) }}
          {% endif %}
        </span>
      </div>
    </div>

    {% if order.order_status == 'Confirmed' or order.order_status == 'Active' %}
    <div class="order-actions">
      <form
        action="{{ url_for('customer.cancel_order', order_code=order.order_code) }}"
        method="POST"
        onsubmit="return confirm('Are you sure you want to cancel this order? A 5% cancellation fee will be applied.');"
      >
        <input
          type="hidden"
          name="email"
          value="{{ request.form.get('email') or session.get('user_id') }}"
        />
        <button type="submit" class="btn btn--danger">Cancel Order</button>
      </form>
    </div>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
