{% extends 'layout/base.html' %} 

{% block content %}
<div class="hero">
  <div class="hero__content">
    <h1 class="hero__title">Welcome to FLYTAU Airline</h1>
    <p class="hero__subtitle">Your journey begins here.</p>

    <div class="search-box">
      <h2 class="search-box__title">Find Your Next Adventure</h2>
      <form action="{{ url_for('customer.index') }}" method="GET" class="search-box__form">
        <div class="search-grid">
            <div class="form-group">
                <label class="form-label" for="source-airport">From</label>
                <div class="input-wrapper">
                    <span class="input-icon">ðŸ›«</span>
                    <select name="source" id="source-airport" class="form-select" aria-label="Select departure airport">
                        <option value="" disabled {% if not request.args.get('source') %}selected{% endif %}>Select Origin</option>
                        {% for airport in airports %}
                        <option value="{{ airport.airport_name }}" {% if request.args.get('source') == airport.airport_name %}selected{% endif %}>{{ airport.airport_name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" for="dest-airport">To</label>
                <div class="input-wrapper">
                    <span class="input-icon">ðŸ›¬</span>
                    <select name="dest" id="dest-airport" class="form-select" aria-label="Select destination airport">
                        <option value="" disabled {% if not request.args.get('dest') %}selected{% endif %}>Select Destination</option>
                        {% for airport in airports %}
                        <option value="{{ airport.airport_name }}" {% if request.args.get('dest') == airport.airport_name %}selected{% endif %}>{{ airport.airport_name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" for="flight-date">Date</label>
                <div class="input-wrapper">
                    <span class="input-icon">ðŸ“…</span>
                    <input type="date" name="date" id="flight-date" class="form-input" value="{{ request.args.get('date', '') }}" min="{{ today_date }}" aria-label="Select flight date">
                </div>
            </div>
            <div class="form-group search-btn-group">
                <button type="submit" class="btn btn--accent btn--block" aria-label="Search for flights">Search Flights</button>
            </div>
        </div>
        
        <details class="advanced-filters">
            <summary>Advanced Options</summary>
            <div class="filters-grid">
                <div class="form-group">
                    <label class="form-label" for="flight-class">Class</label>
                    <select name="class" id="flight-class" class="form-select" aria-label="Select flight class">
                        <option value="Economy" {% if request.args.get('class') == 'Economy' %}selected{% endif %}>Economy</option>
                        <option value="Business" {% if request.args.get('class') == 'Business' %}selected{% endif %}>Business</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="min-price">Min Price</label>
                    <input type="number" name="min_price" id="min-price" class="form-input" value="{{ request.args.get('min_price', '') }}" placeholder="$" aria-label="Minimum price">
                </div>
                <div class="form-group">
                    <label class="form-label" for="max-price">Max Price</label>
                    <input type="number" name="max_price" id="max-price" class="form-input" value="{{ request.args.get('max_price', '') }}" placeholder="$" aria-label="Maximum price">
                </div>
            </div>
        </details>

        <div class="show-all-container">
            <a href="{{ url_for('customer.index', show_all=1) }}" class="link-show-all">View All Available Flights</a>
        </div>
      </form>
    </div>
  </div>
</div>

{% if flights is not none %}
<div class="container results-container">
    <h2 class="results-title">Flight Results</h2>
    <div class="flight-results">
        {% if flights %}
            {% for flight in flights %}
            <div class="card flight-card">
                <div class="flight-info">
                    <div class="route">
                        <h3>{{ flight.source_airport }} <span class="plane-icon">âœˆ</span> {{ flight.dest_airport }}</h3>
                        <p>{{ flight.departure_time }}</p>
                    </div>
                    <div class="details">
                        <p>Duration: {% set hours = flight.flight_duration / 60.0 %}{% if hours == hours|int %}{{ hours|int }} hours{% else %}{{ "%.1f"|format(hours) }} hours{% endif %}</p>
                        <p>Aircraft: {{ flight.manufacturer }}</p>
                    </div>
                    <div class="price">
                        <p class="price-tag">${{ flight.economy_price }} <small>(Economy)</small></p>
                        <p class="price-tag price-tag--biz">${{ flight.business_price }} <small>(Business)</small></p>
                    </div>
                </div>
                <div class="actions">
                    <a href="{{ url_for('customer.book_flight', 
                        source_id=flight.source_airport_id, 
                        dest_id=flight.dest_airport_id, 
                        time=flight.departure_time) }}" class="btn btn--accent">Book Now</a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-state__icon">âœˆ</div>
                <h3 class="empty-state__title">No flights found</h3>
                <p class="empty-state__message">No flights match your search criteria. Try adjusting your filters or <a href="{{ url_for('customer.index', show_all=1) }}" class="empty-state__link">view all available flights</a>.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endif %}

<script>
// Automatically show all flights by default when page loads with no search parameters
(function() {
    const urlParams = new URLSearchParams(window.location.search);
    const hasSearchParams = urlParams.has('source') || urlParams.has('dest') || 
                           urlParams.has('date') || urlParams.has('min_price') || 
                           urlParams.has('max_price') || urlParams.has('class') || 
                           urlParams.has('show_all');
    
    // Check if flights results container exists (flights were loaded)
    const flightsContainer = document.querySelector('.results-container');
    const flightsNotLoaded = flightsContainer === null;
    
    // If no search parameters and flights are not displayed, automatically show all flights
    if (!hasSearchParams && flightsNotLoaded) {
        window.location.href = "{{ url_for('customer.index', show_all=1) }}";
    }
})();
</script>

{% endblock %}
